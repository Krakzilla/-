<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content=height=device-height, initial-scale=1.0, initial-scale=1, maximum-scale=1/>
<style>
canvas {
  margin-top: 30px;
  border:1px solid #d3d3d3;
  background-color: #f6f9f1;
}
html {
overflow: hidden;
}
</style>
</head>
<body onload="startGame()">
<p id="info">XwXwXwXwX</p>
<script>

var myGamePiece;
var showStick;
var showMouse;
var scale = (window.innerWidth / 320);
var paint = false;
var move = {x: 0, y: 0};
var beginning = {x: 0, y: 0};

function info(message){
  document.getElementById("info").innerHTML = message;
}

function startGame() {
    myGamePiece = new component(30, 30, "red", 10, 120);
    myGameArea.start();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
      info(scale);
      document.body.style.height = (window.innerHeight + 50);
        this.canvas.width = (320*(window.innerWidth / 330));
        this.canvas.height = (480*(window.innerWidth / 330));
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.context.scale((window.innerWidth / 320), (window.innerWidth / 320));
        this.interval = setInterval(updateGameArea, 20);
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}


function component(width, height, color, x, y) {
    this.width = width;
    this.height = height;
    this.x = x;
    this.y = y;
    this.update = function(){
        ctx = myGameArea.context;
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    this.input = function(x, y){
      this.x = this.x + x;
      this.y = this.y + y;
  // Rand  if(this.x>)
    }
    }
}

function circle(r, color) {
  this.update = function(){
    ctx = myGameArea.context;
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(beginning.x, beginning.y, r, 0, Math.PI * 2, true);
    ctx.closePath();
    ctx.fill()
   }
  }

window.addEventListener('load', () => {

    document.addEventListener('mousedown', startDrawing);
    document.addEventListener('mouseup', stopDrawing);
    document.addEventListener('mousemove', getCoords);

    document.addEventListener('touchstart', startDrawing);
    document.addEventListener('touchend', stopDrawing);
    document.addEventListener('touchcancel', stopDrawing);
    document.addEventListener('touchmove', getCoords);

});

function startDrawing() {
paint = true;
  var mouse_x = event.clientX || event.touches[0].clientX;
  var mouse_y = event.clientY || event.touches[0].clientY;
beginning.x = (mouse_x - myGameArea.canvas.offsetLeft)/scale;
beginning.y = (mouse_y - myGameArea.canvas.offsetTop)/scale;
    showStick = new circle (30, "rgb(204, 230, 255)");
    drawMouse = new mouse;
  }

function getCoords(event) {
move = { x: ((event.clientX || event.touches[0].clientX) - myGameArea.canvas.offsetLeft)/scale,
 y: ((event.clientY || event.touches[0].clientY) - myGameArea.canvas.offsetTop)/scale};
}

function mouse() {
  this.update = function(event){
    info(beginning.x);

//maximum f√ºr joystick

    myGamePiece.input((move.x-beginning.x)/(scale*10), (move.y-beginning.y)/(scale*10));
      ctx = myGameArea.context;
      ctx.fillStyle = "rgb(0, 0, 0)";
      ctx.beginPath();
      ctx.arc(move.x, move.y, 4, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
      }}


function stopDrawing(event) {
paint = false;
}


function updateGameArea() {
    myGameArea.clear();
    myGamePiece.update();
  if (paint) {
    showStick.update();
    drawMouse.update();
  }

}
</script>
</body>
</html>
